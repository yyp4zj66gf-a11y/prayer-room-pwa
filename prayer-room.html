<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prayer Room</title>
  <style>
    :root{
      --bg: #efe8d6;
      --header: #b30000;
      --card: #ffffff;
      --border: #2b2b2b33;

      --scripture-bg: #e7f6ea;
      --scripture-border: #1f6b2d;

      --list-header: #1f7a1f;
      --list-bg: #eaf8ee;
      --list-border: #2e7d32;

      --prayer-header: #233f8f;
      --prayer-bg: #eef3ff;
      --prayer-border: #203a7a;

      --doctrine-bg: #0c2e5a;
      --doctrine-border: #ffcc00;

      --btn: #f3f3f3;
      --btn-border: #33333355;
      --btn-text: #111;
    }

    html,body{height:100%;}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--bg);
      color:#111;
    }

    .wrap{
      width: min(1200px, 96vw);
      margin: 14px auto 20px;
    }

    .topbar{
      background: var(--header);
      color:#fff;
      padding: 14px 18px;
      border-radius: 10px 10px 0 0;
      display:flex;
      align-items:center;
      justify-content: space-between;
      font-weight: 800;
      letter-spacing: .2px;
    }
    .topbar .title{font-size: 24px;}
    .topbar .date{font-size: 14px; opacity:.95;}

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 2px 10px #00000010;
    }

    .scripture{
      margin-top: 12px;
      background: var(--scripture-bg);
      border: 3px solid var(--scripture-border);
      padding: 14px 14px;
    }
    .scriptureRow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items:center;
    }
    .scriptureLabel{
      font-weight: 800;
      margin-bottom: 6px;
      color:#114d1f;
    }
    .scriptureText{
      font-weight: 800;
      text-align:center;
      padding: 10px 12px;
      background: #ffffffaa;
      border-radius: 10px;
      border: 1px solid #00000014;
      line-height: 1.2;
      font-size: 18px;
      word-break: break-word;
    }

    .btnCol{
      display:flex;
      flex-direction: column;
      gap: 8px;
      align-items: stretch;
      min-width: 90px;
    }
    .btn{
      appearance:none;
      border: 1px solid var(--btn-border);
      background: var(--btn);
      color: var(--btn-text);
      padding: 8px 10px;
      border-radius: 10px;
      font-weight: 800;
      cursor:pointer;
    }
    .btn:active{transform: translateY(1px);}
    .btn.primary{
      background: #ffffff;
      border: 2px solid #1a1a1a55;
    }

    .main{
      margin-top: 14px;
      display:grid;
      grid-template-columns: 270px 1fr;
      gap: 14px;
      align-items: stretch;
    }

    .panelHeader{
      color:#fff;
      padding: 10px 12px;
      border-radius: 10px 10px 0 0;
      font-weight: 900;
      display:flex;
      align-items:center;
      justify-content: space-between;
    }

    .listPanel{
      border: 3px solid var(--list-border);
      background: var(--list-bg);
      overflow:hidden;
    }
    .listPanel .panelHeader{background: var(--list-header);}
    .listBody{padding: 10px;}
    textarea{
      width:100%;
      box-sizing:border-box;
      resize:none;
      border-radius: 10px;
      border: 2px solid #00000022;
      padding: 10px;
      font-size: 16px;
      line-height: 1.25;
      background: #fff;
      min-height: 420px;
    }

    .prayerPanel{
      border: 3px solid var(--prayer-border);
      background: var(--prayer-bg);
      overflow:hidden;
    }
    .prayerPanel .panelHeader{background: var(--prayer-header);}
    .prayerBody{padding: 10px;}
    .prayerControls{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content: flex-start;
      margin: 10px 0 8px;
      flex-wrap: wrap;
      font-weight: 800;
    }
    .prayerControls label{opacity:.95;}
    .prayerControls input[type="date"]{
      padding: 6px 8px;
      border-radius: 10px;
      border: 2px solid #00000022;
      font-weight: 800;
      background:#fff;
    }
    .prayerButtons{
      display:flex;
      gap: 10px;
      justify-content: flex-start;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .doctrine{
      margin-top: 14px;
      border: 3px solid var(--doctrine-border);
      background: var(--doctrine-bg);
      color:#fff;
      padding: 12px 12px;
      border-radius: 12px;
    }
    .doctrineTop{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 12px;
      align-items:center;
    }
    .doctrineTitle{
      text-align:center;
      font-weight: 900;
      font-size: 18px;
      color:#fff;
      text-shadow: 0 1px 0 #00000055;
    }
    .doctrineBtns{
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .doctrineText{
      margin-top: 10px;
      text-align:center;
      font-weight: 800;
      font-size: 16px;
      line-height: 1.25;
      padding: 6px 10px;
      word-break: break-word;
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: #111;
      color:#fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 800;
      opacity: 0;
      pointer-events:none;
      transition: opacity .2s ease;
    }
    .toast.show{opacity: .95;}

    @media (max-width: 980px){
      .main{grid-template-columns: 1fr;}
      textarea{min-height: 240px;}
      .btnCol{flex-direction: row; min-width: unset;}
      .scriptureRow{grid-template-columns: 1fr;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">Lorne’s Prayer Room</div>
      <div class="date" id="todayLabel"></div>
    </div>

    <div class="card scripture">
      <div class="scriptureLabel">Daily Scripture</div>
      <div class="scriptureRow">
        <div class="scriptureText" id="scriptureText">Loading…</div>
        <div class="btnCol">
          <button class="btn primary" id="scrPrev">Prev</button>
          <button class="btn primary" id="scrNext">Next</button>
          <button class="btn primary" id="scrCopy">Copy</button>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="card listPanel">
        <div class="panelHeader">
          <div>Daily Prayer List</div>
          <div style="display:flex; gap:10px;">
            <button class="btn primary" id="saveList">Save List</button>
            <button class="btn primary" id="undoList">Undo</button>
          </div>
        </div>
        <div class="listBody">
          <textarea id="listBox" placeholder="Paste or type names here…"></textarea>
        </div>
      </div>

      <div class="card prayerPanel">
        <div class="panelHeader">
          <div>Prayers &amp; Petitions</div>
          <div style="display:flex; gap:10px; align-items:center;">
            <label for="prayerDate">Date</label>
            <input type="date" id="prayerDate" />
            <button class="btn primary" id="todayBtn">Today</button>
          </div>
        </div>
        <div class="prayerBody">
          <textarea id="prayerBox" placeholder="Write your prayers for the selected date…"></textarea>
          <div class="prayerButtons">
            <button class="btn primary" id="savePrayer">Save Prayer</button>
            <button class="btn primary" id="undoPrayer">Undo</button>
            <button class="btn primary" id="redoPrayer">Redo</button>
          </div>
        </div>
      </div>
    </div>

    <div class="doctrine" id="doctrinePanel">
      <div class="doctrineTop">
        <div class="doctrineTitle" id="doctrineTitle">Salvation Army Doctrine</div>
        <div class="doctrineBtns">
          <button class="btn primary" id="docPrev">Prev</button>
          <button class="btn primary" id="docNext">Next</button>
        </div>
      </div>
      <div class="doctrineText" id="doctrineText">Loading…</div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const DOCTRINES = [
    "We believe that the Scriptures of the Old and New Testaments were given by inspiration of God, and that they only constitute the Divine rule of Christian faith and practice.",
    "We believe that there is only one God, who is infinitely perfect, the Creator, Preserver, and Governor of all things, and who is the only proper object of religious worship.",
    "We believe that there are three persons in the Godhead—the Father, the Son, and the Holy Ghost, undivided in essence and co-equal in power and glory.",
    "We believe that in the person of Jesus Christ the Divine and human natures are united, so that He is truly and properly God and truly and properly man.",
    "We believe that our first parents were created in a state of innocency, but by their disobedience, they lost their purity and happiness, and that in consequence of their fall, all men have become sinners, totally depraved, and as such are justly exposed to the wrath of God.",
    "We believe that the Lord Jesus Christ has by His suffering and death made an atonement for the whole world so that whosoever will may be saved.",
    "We believe that repentance toward God, faith in our Lord Jesus Christ, and regeneration by the Holy Spirit are necessary to salvation.",
    "We believe that we are justified by grace through faith in our Lord Jesus Christ, and that he that believeth hath the witness in himself.",
    "We believe that continuance in a state of salvation depends upon continued obedient faith in Christ.",
    "We believe that it is the privilege of all believers to be wholly sanctified, and that their whole spirit and soul and body may be preserved blameless unto the coming of our Lord Jesus Christ.",
    "We believe in the immortality of the soul; in the resurrection of the body; in the general judgment at the end of the world; in the eternal happiness of the righteous; and in the endless punishment of the wicked."
  ];

  // ---------- Toast ----------
  let toastTimer = null;
  function toast(msg){
    const t = $("toast");
    t.textContent = msg;
    t.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t.classList.remove("show"), 1200);
  }

  // ---------- Date helpers ----------
  function pad(n){ return String(n).padStart(2,"0"); }
  function ymd(d){
    return d.getFullYear() + "-" + pad(d.getMonth()+1) + "-" + pad(d.getDate());
  }
  function dayOfYear(d){
    const start = new Date(d.getFullYear(), 0, 1);
    const diff = d - start;
    return Math.floor(diff / 86400000); // local midnight to local midnight
  }

  // ---------- Scripture loading ----------
  const JSON_CANDIDATES = [
    "nlt_for_app_365.json",
    "nlt_for_app_300.json",
    "nlt_for_app_730.json",
    "nlt_for_app.json"
  ];

  async function fetchFirstJson(){
    for(const file of JSON_CANDIDATES){
      try{
        const res = await fetch(file + "?v=" + Date.now(), {cache:"no-store"});
        if(!res.ok) continue;
        const data = await res.json();
        // Accept either array, or {verses:[...]} shape
        if(Array.isArray(data)) return {file, verses:data};
        if(data && Array.isArray(data.verses)) return {file, verses:data.verses};
      }catch(e){
        // try next
      }
    }
    throw new Error("No JSON file found. Put one of: " + JSON_CANDIDATES.join(", "));
  }

  let verses = [];
  let scrIndex = 0;

  function verseLine(v){
    const ref = v.ref || v.reference || v.scripture_ref || "";
    const text = v.text || v.scripture_text || "";
    if(ref && text) return `${ref} — ${text}`;
    if(ref) return ref;
    if(text) return text;
    return "(No scripture content found in JSON entry)";
  }

  function renderScripture(){
    if(!verses.length){
      $("scriptureText").textContent = "No scripture data loaded.";
      return;
    }
    const v = verses[scrIndex] || verses[0];
    $("scriptureText").textContent = verseLine(v);
  }

  async function copyScripture(){
    const txt = $("scriptureText").textContent.trim();
    try{
      await navigator.clipboard.writeText(txt);
      toast("Copied.");
    }catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = txt;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      toast("Copied.");
    }
  }

  // ---------- Doctrine ----------
  let docIndex = 0;

  function renderDoctrine(){
    $("doctrineTitle").textContent = `Salvation Army Doctrine #${docIndex+1}`;
    $("doctrineText").textContent = DOCTRINES[docIndex];
  }

  // ---------- Storage: Prayer List ----------
  const LIST_KEY = "PRAYERROOM_DAILY_LIST";
  let listUndo = "";

  function loadList(){
    const v = localStorage.getItem(LIST_KEY) || "";
    $("listBox").value = v;
    listUndo = v;
  }

  $("saveList").onclick = () => {
    localStorage.setItem(LIST_KEY, $("listBox").value);
    listUndo = $("listBox").value;
    toast("List saved.");
  };
  $("undoList").onclick = () => {
    $("listBox").value = listUndo;
    toast("Undone.");
  };

  // ---------- Storage: Prayers & Petitions per date ----------
  let prayerUndoStack = [];
  let prayerRedoStack = [];
  let lastPrayerValue = "";

  function prayerKey(dateStr){
    return "PRAYERROOM_PRAYER_" + dateStr;
  }

  function loadPrayerFor(dateStr){
    const v = localStorage.getItem(prayerKey(dateStr)) || "";
    $("prayerBox").value = v;
    prayerUndoStack = [v];
    prayerRedoStack = [];
    lastPrayerValue = v;
  }

  function savePrayerFor(dateStr, text){
    localStorage.setItem(prayerKey(dateStr), text);
  }

  function pushPrayerHistory(nextVal){
    if(nextVal === lastPrayerValue) return;
    prayerUndoStack.push(nextVal);
    if(prayerUndoStack.length > 100) prayerUndoStack.shift();
    prayerRedoStack = [];
    lastPrayerValue = nextVal;
  }

  $("prayerBox").addEventListener("input", () => {
    pushPrayerHistory($("prayerBox").value);
  });

  $("savePrayer").onclick = () => {
    const d = $("prayerDate").value;
    savePrayerFor(d, $("prayerBox").value);
    toast("Prayer saved.");
  };

  $("undoPrayer").onclick = () => {
    if(prayerUndoStack.length <= 1){
      toast("Nothing to undo.");
      return;
    }
    const current = prayerUndoStack.pop();
    prayerRedoStack.push(current);
    const prev = prayerUndoStack[prayerUndoStack.length-1];
    $("prayerBox").value = prev;
    lastPrayerValue = prev;
    toast("Undone.");
  };

  $("redoPrayer").onclick = () => {
    if(!prayerRedoStack.length){
      toast("Nothing to redo.");
      return;
    }
    const next = prayerRedoStack.pop();
    prayerUndoStack.push(next);
    $("prayerBox").value = next;
    lastPrayerValue = next;
    toast("Redone.");
  };

  // ---------- Navigation buttons ----------
  $("scrPrev").onclick = () => {
    if(!verses.length) return;
    scrIndex = (scrIndex - 1 + verses.length) % verses.length;
    renderScripture();
  };
  $("scrNext").onclick = () => {
    if(!verses.length) return;
    scrIndex = (scrIndex + 1) % verses.length;
    renderScripture();
  };
  $("scrCopy").onclick = copyScripture;

  $("docPrev").onclick = () => {
    docIndex = (docIndex - 1 + DOCTRINES.length) % DOCTRINES.length;
    renderDoctrine();
  };
  $("docNext").onclick = () => {
    docIndex = (docIndex + 1) % DOCTRINES.length;
    renderDoctrine();
  };

  // ---------- Init ----------
  function setTodayLabel(){
    const d = new Date();
    const days = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
    $("todayLabel").textContent = `${days[d.getDay()]}, ${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
  }

  $("todayBtn").onclick = () => {
    const d = new Date();
    $("prayerDate").value = ymd(d);
    loadPrayerFor($("prayerDate").value);
    toast("Today.");
  };

  $("prayerDate").addEventListener("change", () => {
    loadPrayerFor($("prayerDate").value);
  });

  async function init(){
    setTodayLabel();

    const now = new Date();
    const doy = dayOfYear(now);

    // doctrine rotates daily
    docIndex = doy % DOCTRINES.length;
    renderDoctrine();

    // prayer date defaults today
    $("prayerDate").value = ymd(now);
    loadPrayerFor($("prayerDate").value);

    // prayer list
    loadList();

    // scripture
    try{
      const out = await fetchFirstJson();
      verses = out.verses;
      // If exactly 365 entries, map day-of-year directly; else wrap.
      scrIndex = verses.length === 365 ? Math.min(doy, verses.length-1) : (doy % verses.length);
      renderScripture();
      toast("Loaded daily content.");
    }catch(e){
      $("scriptureText").textContent = e.message;
      toast("Scripture JSON missing.");
    }
  }

  init();
})();
</script>
</body>
</html>

